/*
 * Copyright 2015 LinkedIn Corp. Licensed under the Apache License, Version 2.0 (the "License");
 * You may not use this file except in compliance with the License.
 * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 */

 package com.secbro.qark;

 import android.content.Intent;
 import android.content.res.Configuration;
 import android.os.Bundle;
 import android.view.MenuItem;
 
 import androidx.annotation.NonNull;
 import androidx.appcompat.app.ActionBarDrawerToggle;
 import androidx.appcompat.app.AppCompatActivity; // Migrated to AndroidX
 import androidx.appcompat.widget.Toolbar;
 import androidx.core.view.GravityCompat;
 import androidx.drawerlayout.widget.DrawerLayout; // Migrated to AndroidX
 import com.google.android.material.navigation.NavigationView; // Migrated to AndroidX
 
 import com.secbro.qark.customintent.CreateCustomIntentActivity;
 import com.secbro.qark.intentsniffer.BroadcastIntentSnifferFragment;
 import com.secbro.qark.exportedcomponent.ExportedComponentsFragment;
 import com.secbro.qark.filebrowser.FileBrowserFragment;
 import com.secbro.qark.tapjacking.TapJackingExploitFragment;
 import com.secbro.qark.webviewtests.WebViewTestsActivityFragment;
 
 public class TopLevelActivity extends AppCompatActivity {
 
     private DrawerLayout mDrawer;
     private NavigationView mNavigationView;
     private Toolbar mToolbar;
     private ActionBarDrawerToggle mDrawerToggle;
 
     public static String PACKAGE_NAME = "com.secbro.qark";
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_top_level);
         PACKAGE_NAME = getApplicationContext().getPackageName();
 
         // Set up the Toolbar
         mToolbar = findViewById(R.id.toolbar);
         setSupportActionBar(mToolbar);
 
         // Set up Drawer Layout
         mDrawer = findViewById(R.id.drawer_layout);
         mDrawerToggle = setupDrawerToggle();
         mDrawer.addDrawerListener(mDrawerToggle); // Replaced deprecated setDrawerListener
 
         // Set up Navigation View
         mNavigationView = findViewById(R.id.nvView);
         setupDrawerContent(mNavigationView);
     }
 
     private ActionBarDrawerToggle setupDrawerToggle() {
         return new ActionBarDrawerToggle(
                 this, mDrawer, mToolbar,
                 R.string.drawer_open, R.string.drawer_close
         );
     }
 
     private void setupDrawerContent(NavigationView navigationView) {
         navigationView.setNavigationItemSelectedListener(this::selectDrawerItem);
     }
 
     @Override
     protected void onPostCreate(Bundle savedInstanceState) {
         super.onPostCreate(savedInstanceState);
         mDrawerToggle.syncState();
     }
 
     @Override
     public void onConfigurationChanged(@NonNull Configuration newConfig) {
         super.onConfigurationChanged(newConfig);
         mDrawerToggle.onConfigurationChanged(newConfig);
     }
 
     public boolean selectDrawerItem(@NonNull MenuItem menuItem) {
         // Update the main content by replacing fragments
         Fragment fragment = null;
 
         switch (menuItem.getItemId()) {
             case R.id.nav_broadcast_intent_sniffer:
                 fragment = BroadcastIntentSnifferFragment.newInstance();
                 break;
             case R.id.nav_exported_components:
                 fragment = new ExportedComponentsFragment();
                 break;
             case R.id.nav_tap_jacking:
                 fragment = new TapJackingExploitFragment();
                 break;
             case R.id.nav_web_view_tests:
                 fragment = new WebViewTestsActivityFragment();
                 break;
             case R.id.nav_file_browser:
                 fragment = FileBrowserFragment.newInstance();
                 Bundle args = new Bundle();
                 args.putString(FileBrowserFragment.INTENT_ACTION_SELECT_FILE, FileBrowserFragment.INTENT_ACTION_SELECT_FILE);
                 fragment.setArguments(args);
                 break;
             case R.id.nav_custom_intent:
                 startActivity(new Intent(this, CreateCustomIntentActivity.class));
                 break;
             default:
                 Log.e("TopLevelActivity", "Unknown menu item selected");
                 break;
         }
 
         if (fragment != null) {
             getSupportFragmentManager()
                     .beginTransaction()
                     .replace(R.id.container, fragment)
                     .commit();
         }
 
         // Highlight the selected item and close the drawer
         menuItem.setChecked(true);
         setTitle(menuItem.getTitle());
         mDrawer.closeDrawers();
         return true;
     }
 
     @Override
     public boolean onOptionsItemSelected(@NonNull MenuItem item) {
         if (mDrawerToggle.onOptionsItemSelected(item)) {
             return true;
         }
         if (item.getItemId() == android.R.id.home) {
             mDrawer.openDrawer(GravityCompat.START);
             return true;
         }
         return super.onOptionsItemSelected(item);
     }
 }
 