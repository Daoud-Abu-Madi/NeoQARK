@echo off

:: Gradle start-up script for Windows
:: Updated for better compatibility and error handling

setlocal

set DEFAULT_JVM_OPTS=-Xmx1024m -XX:+UseG1GC
set APP_NAME=Gradle
set APP_BASE_NAME=%~n0

:: Ensure Java is available
if not defined JAVA_HOME (
    where java > nul 2> nul
    if errorlevel 1 (
        echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
        echo Please install Java or set JAVA_HOME correctly.
        exit /b 1
    )
    set "JAVACMD=java"
) else (
    set "JAVACMD=%JAVA_HOME%\bin\java.exe"
    if not exist "%JAVACMD%" (
        echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
        echo Please ensure it points to a valid Java installation.
        exit /b 1
    )
)

:: Set Application Home Directory
set "APP_HOME=%~dp0"
set "CLASSPATH=%APP_HOME%gradle\wrapper\gradle-wrapper.jar"

if not exist "%CLASSPATH%" (
    echo ERROR: gradle-wrapper.jar not found in %APP_HOME%\gradle\wrapper
    echo Please ensure the Gradle Wrapper is correctly configured.
    exit /b 1
)

:: Setup JVM and Gradle Options
set "JAVA_OPTS=%JAVA_OPTS% %DEFAULT_JVM_OPTS%"
set "GRADLE_OPTS=%GRADLE_OPTS%"

:: Run Gradle
echo Starting Gradle with Java: %JAVACMD%
"%JAVACMD%" %JAVA_OPTS% -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %*
if errorlevel 1 (
    echo ERROR: Gradle execution failed.
    exit /b 1
)

endlocal
